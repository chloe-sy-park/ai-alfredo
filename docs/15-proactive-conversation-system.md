# 🐧 알프레도 능동적 대화 시스템 설계

> **버전**: v1.0  
> **작성일**: 2025-01-11  
> **목표**: 알프레도가 "먼저 말을 거는" 시스템 설계 - ADHD 사용자에게 적절한 타이밍에 도움 제공

---

## 1. 철학 & 원칙

### 왜 능동적 대화인가?

**ADHD 사용자의 특성:**
- 스스로 시작하기 어려움 (Initiation difficulty)
- 시간 감각 부족 (Time blindness)
- 외부 자극에 의존 (External cue dependency)
- 과집중 시 전환 어려움 (Hyperfocus transition)

**알프레도의 역할:**
> "사용자가 요청하기 전에 필요한 것을 제안하는 버틀러"

벤치마킹 인사이트:
- **Anima AI**: AI가 먼저 말을 거는 것이 ADHD 사용자에게 특히 유용
- **Pi**: "지금 뭐가 필요해?"로 사용자에게 선택권 제공
- **Woebot**: 정기적 체크인으로 습관 형성

### 핵심 원칙

| 원칙 | 설명 | 안티패턴 |
|------|------|----------|
| **적시성** | 필요한 순간에 나타남 | 무작위 알림 폭탄 |
| **선택권** | 제안하되 강요하지 않음 | "이거 해야 해" 명령 |
| **맥락 인식** | 상황에 맞는 메시지 | 바쁠 때 잡담 |
| **점진적** | 빈도 조절 가능 | 처음부터 과도한 개입 |
| **따뜻함** | 버틀러의 배려 | 로봇같은 알림 |

---

## 2. 트리거 시스템

### 2-1. 시간 기반 트리거 (Time-based)

| 트리거 | 시간 | 조건 | 우선순위 |
|--------|------|------|----------|
| 🌅 아침 브리핑 | 기상 시간 or 설정 시간 | 매일 | 🔴 High |
| ☀️ 점심 체크인 | 12:00-13:00 | 오전 활동 있을 때 | 🟡 Medium |
| 🌆 저녁 리뷰 | 퇴근 시간 or 설정 시간 | 매일 | 🔴 High |
| 🌙 수면 준비 | 취침 1시간 전 | 설정 시 | 🟢 Low |
| 📅 주간 회고 | 일요일 저녁 | 매주 | 🟡 Medium |

**사용자 설정 반영:**
```
크로노타입: 아침형 → 브리핑 7:00
크로노타입: 저녁형 → 브리핑 9:30
```

### 2-2. 이벤트 기반 트리거 (Event-based)

| 트리거 | 이벤트 | 메시지 유형 |
|--------|--------|------------|
| 📱 앱 열기 | 앱 실행 | 컨텍스트 인사 |
| ✅ 태스크 완료 | task.complete | 축하 + 다음 제안 |
| ⏰ 미팅 30분 전 | calendar.reminder | 준비 리마인드 |
| 🔥 스트릭 달성 | habit.streak_milestone | 축하 |
| 🎯 탑3 완료 | top_three.all_complete | 대축하 |
| 📊 인사이트 발견 | insight.new | 공유 |

### 2-3. 상태 기반 트리거 (State-based)

| 트리거 | 감지 조건 | 메시지 유형 |
|--------|----------|------------|
| 😴 오랜 비활동 | 2시간+ 앱 미사용 | 부드러운 체크인 |
| 🔄 반복 미루기 | 같은 태스크 3회+ defer | 도움 제안 |
| 📈 과부하 감지 | 오늘 태스크 10개+ | 우선순위 도움 |
| ⚡ 에너지 저하 추정 | 오후 슬럼프 시간대 | 휴식 제안 |
| 🎉 성취 누적 | 주간 목표 초과 달성 | 칭찬 |
| ⚠️ 번아웃 신호 | 스트레스 패턴 감지 | 케어 메시지 |

### 2-4. 캘린더 기반 트리거 (Calendar-based)

DNA 확장 엔진과 연동:

| 트리거 | 조건 | 메시지 유형 |
|--------|------|------------|
| 🗓️ 바쁜 날 시작 | 미팅 4개+ 예정 | 격려 + 전략 |
| 🕐 빈 시간 감지 | 2시간+ 빈 블록 | 집중 시간 제안 |
| 🏃 미팅 연속 | 3개+ 연속 미팅 후 | 휴식 리마인드 |
| 📋 중요 일정 전날 | 발표/면접 등 | 준비 체크인 |
| 🎂 특별한 날 | 기념일/생일 | 축하 메시지 |

---

## 3. 메시지 유형

### 3-1. 브리핑 (Briefing)

**목적**: 하루/주간 상황 요약 및 준비

```
┌─────────────────────────────────────┐
│  🐧 좋은 아침이에요!                   │
│                                     │
│  오늘 미팅 2개, 마감 1개 있어요.        │
│                                     │
│  🎯 오늘의 탑3:                       │
│  1. 보고서 초안 작성                   │
│  2. 팀 미팅 (14:00)                   │
│  3. 이메일 정리                       │
│                                     │
│  오후 3시 이후 집중 시간 있어요!        │
│                                     │
│  [오늘 시작하기]  [나중에]             │
└─────────────────────────────────────┘
```

**유형:**
- 🌅 아침 브리핑: 오늘 일정 + 탑3 + 날씨
- 🌆 저녁 리뷰: 완료 현황 + 내일 프리뷰 + 칭찬
- 📅 주간 회고: 주간 성과 + 패턴 인사이트 + 다음 주 제안

### 3-2. 넛지 (Nudge)

**목적**: 부드러운 리마인더, 행동 유도

**플로팅 넛지 UI:**
```
┌───────────────────────┐
│ 🐧 미팅 30분 전이에요!  │
│    준비되셨어요?        │
│ [네!] [5분만]          │
└───────────────────────┘
```

**넛지 종류:**

| 유형 | 상황 | 예시 |
|------|------|------|
| ⏰ 시간 넛지 | 일정 전 | "미팅 30분 전이에요!" |
| 🎯 태스크 넛지 | 미완료 태스크 | "보고서 마무리할까요?" |
| 🧘 휴식 넛지 | 장시간 집중 후 | "눈 좀 쉬어요~" |
| 💪 동기 넛지 | 에너지 저하 시 | "거의 다 왔어요!" |
| 🔄 전환 넛지 | 과집중 감지 | "다음 일정 있어요" |

### 3-3. 체크인 (Check-in)

**목적**: 상태 확인, 관계 유지

```
┌─────────────────────────────────────┐
│  🐧 오후가 됐네요!                    │
│                                     │
│  지금 기분이 어때요?                  │
│                                     │
│  [😊 좋아요]  [😐 보통]  [😔 힘들어요]  │
│                                     │
│  [그냥 넘어가기]                      │
└─────────────────────────────────────┘
```

**체크인 종류:**
- 🌤️ 컨디션 체크인: 에너지/기분 확인
- 📋 진행 체크인: 태스크 진행 상황
- 💭 열린 체크인: "뭐 도와드릴까요?"

### 3-4. 축하 (Celebration)

**목적**: 성취 인정, 긍정 강화

```
┌─────────────────────────────────────┐
│  🎉 와! 탑3 다 끝냈어요!               │
│                                     │
│  오늘 정말 잘했어요 👏                │
│  +50 XP 획득!                        │
│                                     │
│  [기분 좋아요!]  [더 할래요]           │
└─────────────────────────────────────┘
```

**축하 트리거:**
- ✅ 태스크 완료
- 🎯 탑3 전체 완료
- 🔥 스트릭 달성 (3일, 7일, 30일...)
- 📈 레벨업
- 🏆 업적 해금
- 📊 주간 목표 달성

### 3-5. 케어 (Care)

**목적**: 힘든 순간 지지, 웰빙 관리

```
┌─────────────────────────────────────┐
│  🐧 요즘 일정이 많이 바뀌네요.          │
│                                     │
│  혹시 좀 힘드신 건 아닌지...           │
│  괜찮으세요?                         │
│                                     │
│  [괜찮아요]  [좀 힘들어요]  [얘기할래요] │
└─────────────────────────────────────┘
```

**케어 트리거:**
- 📉 스트레스 신호 감지 (일정 취소/변경 급증)
- 😔 낮은 컨디션 연속
- 🌙 늦은 시간 활동
- ⏸️ 오랜 비활동 후 복귀

---

## 4. 시간대별 톤 분기

### 4-1. 시간대 정의

| 시간대 | 시간 | 톤 | 목적 |
|--------|------|-----|------|
| 🌅 아침 | 기상~10:00 | 부드럽고 따뜻 | 하루 시작 준비 |
| ☀️ 오전 | 10:00~12:00 | 집중 지원 | 생산성 피크 활용 |
| 🍽️ 점심 | 12:00~14:00 | 가볍고 친근 | 휴식 & 재충전 |
| 🌤️ 오후 | 14:00~18:00 | 격려 & 지지 | 슬럼프 극복 |
| 🌆 저녁 | 18:00~21:00 | 따뜻한 마무리 | 회고 & 정리 |
| 🌙 밤 | 21:00~기상 | 차분하고 조용 | 휴식 유도 |

### 4-2. 톤 매트릭스

```
시간대별 톤 조절 (1-5 스케일)

           아침  오전  점심  오후  저녁   밤
따뜻함      5    3    4    4    5    5
에너지      3    4    3    3    2    1
유머        2    2    4    3    3    1
긴급성      2    4    2    3    2    1
격려        4    3    3    5    4    3
```

### 4-3. 시간대별 인사 예시

**🌅 아침 (기상~10:00)**
```
"좋은 아침이에요 ☀️"
"오늘도 함께해요"
"부드럽게 시작해볼까요?"
"일어나셨군요! 어떠세요?"
```

**☀️ 오전 (10:00~12:00)**
```
"집중 모드 시작할까요?"
"오전 시간 잘 활용해봐요"
"지금이 집중하기 좋은 시간이에요"
```

**🍽️ 점심 (12:00~14:00)**
```
"점심 드셨어요? 🍙"
"잠깐 쉬어가는 건 어때요?"
"오전에 열심히 했네요!"
"배터리 충전 시간이에요"
```

**🌤️ 오후 (14:00~18:00)**
```
"오후도 화이팅! 💪"
"조금만 더 힘내요"
"거의 다 왔어요!"
"오후 슬럼프 타임... 괜찮아요"
"남은 시간 잘 마무리해봐요"
```

**🌆 저녁 (18:00~21:00)**
```
"오늘 하루 수고했어요"
"이제 좀 쉬어도 돼요"
"잘 마무리했네요 👏"
"오늘 하루 어땠어요?"
```

**🌙 밤 (21:00~기상)**
```
"이제 쉴 시간이에요"
"오늘도 고생 많았어요"
"편히 쉬세요"
"내일 또 봐요 🌙"
```

---

## 5. 빈도 조절 시스템

### 5-1. 기본 빈도 제한

| 메시지 유형 | 최소 간격 | 일일 최대 |
|------------|----------|----------|
| 브리핑 | 4시간 | 3회 |
| 넛지 | 30분 | 8회 |
| 체크인 | 2시간 | 4회 |
| 축하 | 없음 (이벤트 기반) | 무제한 |
| 케어 | 4시간 | 2회 |

### 5-2. Proactivity 축 연동

사용자 설정의 `proactivity` 값 (1-5)에 따라 조절:

| 레벨 | 설명 | 빈도 배율 |
|------|------|----------|
| 1 | 최소 개입 | 0.3x |
| 2 | 조용한 지원 | 0.6x |
| 3 | 균형 (기본) | 1.0x |
| 4 | 적극적 지원 | 1.3x |
| 5 | 밀착 케어 | 1.6x |

**예시:**
```
proactivity = 1 → 넛지 일일 최대: 8 × 0.3 = 2~3회
proactivity = 5 → 넛지 일일 최대: 8 × 1.6 = 12~13회
```

### 5-3. 상황별 빈도 조절

| 상황 | 빈도 조절 |
|------|----------|
| 집중 모드 중 | 🔇 모든 메시지 보류 |
| 미팅 중 | 🔇 긴급 아니면 보류 |
| 컨디션 낮음 | ⬇️ 빈도 50% 감소 |
| 스트레스 감지 | ⬇️ 넛지 감소, 케어 증가 |
| 연속 성공 | ⬆️ 축하 빈도 증가 |
| 메시지 무시 연속 | ⬇️ 빈도 자동 감소 |

### 5-4. 스마트 타이밍

**보내지 않는 순간:**
- 🔕 방해금지 모드
- 📅 미팅 중 (캘린더 확인)
- 🎯 집중 모드 활성화
- 🌙 수면 시간대 (설정 기반)
- ⏳ 최근 메시지 후 30분 이내

**최적 타이밍:**
- 📱 앱 열었을 때
- ✅ 태스크 완료 직후
- ⏰ 일정 시작/종료 전후
- 📊 자연스러운 전환점

---

## 6. 우선순위 시스템

### 6-1. 메시지 우선순위

```
우선순위 큐:

🔴 Critical (즉시)
├─ 미팅 5분 전 알림
├─ 긴급 마감 알림
└─ 시스템 경고

🟠 High (다음 자연스러운 시점)
├─ 아침 브리핑
├─ 저녁 리뷰
└─ 중요 일정 리마인더

🟡 Medium (여유 있을 때)
├─ 체크인
├─ 넛지
└─ 인사이트 공유

🟢 Low (조건 충족 시)
├─ 휴식 제안
├─ 일반 축하
└─ 팁/제안
```

### 6-2. 충돌 해결

같은 시간에 여러 메시지 예정 시:

1. **우선순위 높은 것만** 전송
2. **관련 메시지 병합** (가능 시)
3. **낮은 우선순위는 지연** 또는 취소

```
예시: 14:00에 브리핑 + 넛지 + 체크인 예정
→ 브리핑만 전송
→ 넛지는 14:30으로 지연
→ 체크인은 취소 (브리핑에 포함)
```

---

## 7. 메시지 템플릿 구조

### 7-1. 템플릿 스키마

```typescript
interface ProactiveMessage {
  id: string;
  type: 'briefing' | 'nudge' | 'checkin' | 'celebration' | 'care';
  trigger: TriggerType;
  priority: 'critical' | 'high' | 'medium' | 'low';
  
  content: {
    title: string;
    body: string;
    emoji?: string;
    actions?: Action[];
  };
  
  timing: {
    timeOfDay: TimeOfDay;
    minInterval: number;  // 분
    cooldown: number;     // 분
  };
  
  conditions: {
    requiredState?: UserState;
    excludeState?: UserState;
    proactivityMin?: number;  // 1-5
  };
  
  variations: string[];  // 다양한 표현
}
```

### 7-2. 예시 템플릿

```typescript
const morningBriefing: ProactiveMessage = {
  id: 'briefing_morning',
  type: 'briefing',
  trigger: { type: 'time', time: 'morning' },
  priority: 'high',
  
  content: {
    title: '좋은 아침이에요!',
    body: '오늘 {meetingCount}개 미팅, {taskCount}개 태스크가 있어요.',
    emoji: '🌅',
    actions: [
      { label: '오늘 시작하기', action: 'view_today' },
      { label: '나중에', action: 'dismiss' }
    ]
  },
  
  timing: {
    timeOfDay: 'morning',
    minInterval: 1440,  // 24시간
    cooldown: 240       // 4시간
  },
  
  conditions: {
    excludeState: 'sleeping',
    proactivityMin: 2
  },
  
  variations: [
    '좋은 아침이에요! ☀️',
    '오늘도 함께해요',
    '새로운 하루가 시작됐어요!',
    '일어나셨군요! 어떠세요?'
  ]
};
```

---

## 8. 사용자 반응 학습

### 8-1. 추적할 신호

| 신호 | 의미 | 조치 |
|------|------|------|
| 즉시 응답 | 관심 있음 | 유사 메시지 유지 |
| 클릭 후 행동 | 효과적 | 빈도 유지/증가 |
| 무시 | 관심 없음/바쁨 | 빈도 감소 |
| "나중에" 선택 | 타이밍 안 맞음 | 시간 조절 |
| 반복 무시 | 유형 맞지 않음 | 해당 유형 감소 |
| 빠른 dismiss | 방해됨 | 빈도 대폭 감소 |

### 8-2. 학습 적용

```
무시 2회 연속 → 해당 유형 빈도 -20%
무시 3회 연속 → 해당 유형 빈도 -50%
무시 5회 연속 → 해당 유형 일시 중단 + "알림 줄일까요?" 제안

즉시 응답 3회 연속 → 해당 유형 빈도 +20%
클릭 후 태스크 완료 → 해당 넛지 효과 있음 표시
```

---

## 9. 구현 가이드

### 9-1. 데이터 흐름

```
┌─────────────────────────────────────────────────────────┐
│                    Trigger Engine                        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐              │
│  │  Time    │  │  Event   │  │  State   │              │
│  │ Triggers │  │ Triggers │  │ Triggers │              │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘              │
│       └─────────────┼─────────────┘                     │
│                     ▼                                    │
│            ┌─────────────────┐                          │
│            │  Priority Queue │                          │
│            └────────┬────────┘                          │
│                     ▼                                    │
│            ┌─────────────────┐                          │
│            │  Timing Filter  │ ← User Settings          │
│            │  (빈도 조절)     │ ← Proactivity Level      │
│            └────────┬────────┘                          │
│                     ▼                                    │
│            ┌─────────────────┐                          │
│            │ Message Builder │ ← Time of Day            │
│            │  (톤 적용)       │ ← User Tone Preset       │
│            └────────┬────────┘                          │
│                     ▼                                    │
│            ┌─────────────────┐                          │
│            │   Delivery      │ → Push / In-App / Both   │
│            └─────────────────┘                          │
└─────────────────────────────────────────────────────────┘
```

### 9-2. 핵심 컴포넌트

```
src/
├── services/
│   └── proactive/
│       ├── TriggerEngine.ts      # 트리거 감지
│       ├── MessageQueue.ts       # 우선순위 큐
│       ├── TimingController.ts   # 빈도 조절
│       ├── ToneAdapter.ts        # 시간대별 톤
│       └── DeliveryManager.ts    # 전송 관리
│
├── components/
│   └── proactive/
│       ├── FloatingNudge.tsx     # 플로팅 넛지 UI
│       ├── BriefingCard.tsx      # 브리핑 카드
│       ├── CheckInModal.tsx      # 체크인 모달
│       └── CelebrationToast.tsx  # 축하 토스트
│
└── data/
    └── proactive/
        ├── messageTemplates.ts   # 메시지 템플릿
        ├── triggerConfigs.ts     # 트리거 설정
        └── toneVariations.ts     # 톤 변형
```

### 9-3. ERD 연동

`briefings` 테이블 활용:
```sql
-- 전송된 능동적 메시지 기록
INSERT INTO briefings (user_id, type, content, context_data, was_read, created_at)
VALUES (
  'user-uuid',
  'nudge',           -- briefing, nudge, checkin, celebration, care
  '미팅 30분 전이에요! 준비되셨어요?',
  '{"trigger": "meeting_reminder", "meeting_id": "...", "response": "acknowledged"}',
  true,
  NOW()
);
```

---

## 10. 예시 시나리오

### 시나리오 1: 평범한 월요일 아침

```
08:30 - 사용자 기상 (크로노타입: 아침형)

08:35 - 앱 열기
  🐧 "좋은 아침이에요! ☀️
      오늘 미팅 2개, 마감 1개 있어요.
      집중할 수 있는 시간은 오후 2-4시에요!"
      [오늘 확인하기] [나중에]

10:00 - 첫 태스크 시작 안 함
  (트리거 대기...)

10:30 - 여전히 시작 안 함
  🐧 "탑3 중에 뭐부터 시작해볼까요?"
      [보고서 작성] [이메일 정리] [직접 선택]

12:15 - 오전 태스크 1개 완료
  🐧 "좋아요! 점심 드세요 🍙"
      (체크인 건너뜀 - 최근 메시지 30분 이내)

14:00 - 미팅 30분 전
  🐧 "팀 미팅 30분 전이에요! 준비되셨어요?"
      [네!] [5분만]
```

### 시나리오 2: 바쁜 수요일 (스트레스 감지)

```
09:00 - 아침 브리핑
  🐧 "오늘 미팅 5개... 빡빡한 하루네요.
      사이사이 5분씩 숨 돌리기 추천해요!"
      [일정 확인] [그냥 시작]

13:00 - 미팅 3개 연속 후
  🐧 "미팅 3개 연속 끝! 잠깐 쉬어가요 🧘"
      [5분 휴식] [바로 다음으로]

15:00 - 일정 변경 2회 감지
  (케어 트리거 활성화, 아직 전송 안 함)

17:00 - 일정 취소 1회 추가 감지
  🐧 "오늘 일정이 많이 바뀌네요.
      혹시 좀 힘드신 건 아닌지... 괜찮으세요?"
      [괜찮아요] [좀 힘들어요]

18:30 - 저녁 리뷰
  🐧 "오늘 힘든 하루였는데, 그래도 3개나 끝냈어요.
      진짜 고생 많았어요 👏"
      (평소보다 따뜻한 톤)
```

### 시나리오 3: 성취의 금요일

```
14:00 - 탑3 마지막 태스크 완료
  🎉 "와! 탑3 다 끝냈어요!
      금요일에 이렇게 마무리하다니 최고예요! 🏆
      +100 XP, 🪙 50 코인 획득!"
      [기분 좋아요!] [더 할래요]

16:00 - 주간 목표 초과 달성
  🐧 "이번 주 목표 120% 달성! 대단해요 ⭐
      주말에 푹 쉬어도 돼요~"

18:00 - 금요일 저녁 브리핑
  🐧 "이번 주도 잘 마무리했어요!
      
      📊 이번 주 하이라이트:
      - 태스크 15개 완료
      - 집중 시간 12시간
      - 스트릭 7일 달성!
      
      좋은 주말 보내세요! 🌴"
```

---

## 11. 성공 지표

### 11-1. 정량 지표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| 메시지 응답률 | 60%+ | 클릭/응답 ÷ 전송 |
| 무시율 | 30% 이하 | 무시 ÷ 전송 |
| 즉시 응답 비율 | 40%+ | 10초 내 응답 |
| 행동 전환율 | 50%+ | 메시지 후 태스크 시작 |
| 빈도 불만율 | 5% 이하 | 빈도 줄이기 요청 |

### 11-2. 정성 지표

- "어떻게 알았어?" 반응 빈도
- 알프레도 성격에 대한 긍정 피드백
- 능동적 메시지로 인한 태스크 시작 사례
- 케어 메시지에 대한 감사 표현

---

## 12. 구현 우선순위

### Phase 1: MVP (W1-W2)
- [ ] 시간 기반 트리거 (아침/저녁 브리핑)
- [ ] 기본 넛지 시스템
- [ ] 시간대별 톤 분기 (6단계)
- [ ] 플로팅 넛지 UI 컴포넌트

### Phase 2: 스마트 (W3-W4)
- [ ] 이벤트 기반 트리거
- [ ] 축하 시스템
- [ ] 빈도 조절 시스템
- [ ] Proactivity 설정 연동

### Phase 3: 지능화 (2월)
- [ ] 상태 기반 트리거
- [ ] 캘린더 기반 트리거
- [ ] 사용자 반응 학습
- [ ] 케어 시스템

---

## 📝 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2025-01-11 | v1.0 | 초기 설계 문서 작성 |

---

*이 문서는 알프레도 능동적 대화 시스템의 설계 가이드입니다.*
*"사용자가 요청하기 전에, 필요한 것을 제안하는 버틀러"를 구현합니다.*
